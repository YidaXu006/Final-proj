(* ====================== 任务一 ====================== *)
(* ====================== 1. 定义三维矢量场 ====================== *)
(* 定义矢量场A = (y, -x, z)，使用{x,y,z}作为自变量 *)
A = {y, -x, z};
(* 定义矢量场B = (x², y², z²) *)
B = {x^2, y^2, z^2};

(* ====================== 2. 计算叉积 A × B ====================== *)
(* Cross[]函数用于计算矢量叉积，等价于数学中的×运算 *)
crossProduct = Cross[A, B];
(* 输出叉积结果，并添加说明标签 *)
Print["叉积 A × B 的结果："];
Print[crossProduct];
Print["--------------------------------------------------"];

(* ====================== 3. 计算旋度 ∇×A 和 ∇×B ====================== *)
(* Curl[矢量场, {x,y,z}] 用于计算三维空间中矢量场的旋度，等价于∇×运算 *)
curlA = Curl[A, {x, y, z}];
curlB = Curl[B, {x, y, z}];
(* 输出旋度结果 *)
Print["旋度 ∇×A 的结果："];
Print[curlA];
Print["旋度 ∇×B 的结果："];
Print[curlB];
Print["--------------------------------------------------"];

(* ====================== 4. 验证恒等式 ∇×(∇φ) = 0 ====================== *)
(* 步骤1：定义一个任意的标量场φ（示例：取φ = x³ + y² z + z⁴，可替换为任意标量函数） *)
φ = x^3 + y^2 z + z^4;
(* 步骤2：计算标量场的梯度 ∇φ（Grad[标量场, {x,y,z}] 对应梯度运算） *)
gradφ = Grad[φ, {x, y, z}];
(* 步骤3：计算梯度场的旋度 ∇×(∇φ) *)
curlGradφ = Curl[gradφ, {x, y, z}];
(* 输出验证过程和结果 *)
Print["验证 ∇×(∇φ) = 0 的过程："];
Print["定义的任意标量场 φ = ", φ];
Print["标量场φ的梯度 ∇φ = ", gradφ];
Print["梯度场的旋度 ∇×(∇φ) = ", curlGradφ];
(* 额外验证：直接输出是否等于零矢量，增强可读性 *)
If[curlGradφ === {0, 0, 0}, 
    Print["验证结果：∇×(∇φ) = 0，恒等式成立！"], 
    Print["验证结果：恒等式不成立（仅当φ取任意标量场时不可能出现）"]
];

(* ====================== 任务二 ====================== *)
ClearAll[x, y, z, q, k, φ, Efield, r1, r2, r3];  (* 清空变量，规避内置符号冲突 *)
(* 全局参数设定：q=1，库仑常数k=1/(4πε₀)=1 *)
q = 1;
k = 1;

(* ====================== 1. 点电荷系统静电场计算 (4分) ====================== *)
(* -------------------- 1.1 定义单个点电荷的电势/电场公式 -------------------- *)
(* 场点到三个点电荷的距离（纯符号表达式） *)
r1 = Sqrt[(x - 1)^2 + y^2 + z^2];  (* 场点到(1,0,0)的距离 *)
r2 = Sqrt[(x + 1)^2 + y^2 + z^2];  (* 场点到(-1,0,0)的距离 *)
r3 = Sqrt[x^2 + y^2 + (z - 1)^2];  (* 场点到(0,0,1)的距离 *)

(* 总电势：三个点电荷电势叠加（标量叠加） *)
φ = k*q/r1 + k*q/r2 + k*(-2q)/r3;
Print["总电势 φ(x,y,z) 的表达式："];
Print[φ // Simplify];
Print["--------------------------------------------------"];

(* 总电场：E = -∇φ （梯度的负值，矢量）→ 重命名为Efield，避免与内置E冲突 *)
Efield = Simplify[-Grad[φ, {x, y, z}]];
Print["总电场 E(x,y,z) 的表达式（分量形式）："];
Print[Efield];
Print["--------------------------------------------------"];

(* -------------------- 1.2 z=0平面的等势线绘制（ContourPlot） -------------------- *)
φ_z0 = Simplify[φ /. z -> 0];  (* 固定z=0，得到φ(x,y,0) *)
contourPlot = ContourPlot[
    φ_z0,
    {x, -3, 3}, {y, -3, 3},
    PlotLabel -> "z=0平面的等势线",
    ContourLabels -> True,
    ColorFunction -> "Rainbow",
    FrameLabel -> {"x", "y"},
    PlotLegends -> Automatic,
    BaseStyle -> {FontSize -> 10}
];
Print["z=0平面等势线图："];
Show[contourPlot];
Print["--------------------------------------------------"];

(* -------------------- 1.3 z=0平面的电场线绘制（StreamPlot） -------------------- *)
Efield_z0 = Simplify[Efield /. z -> 0];  (* 固定z=0，得到电场矢量 *)
Efield_x = Efield_z0[[1]];  (* 提取x分量 *)
Efield_y = Efield_z0[[2]];  (* 提取y分量 *)

streamPlot = StreamPlot[
    {Efield_x, Efield_y},
    {x, -3, 3}, {y, -3, 3},
    PlotLabel -> "z=0平面的电场线",
    FrameLabel -> {"x", "y"},
    StreamColorFunction -> "TemperatureMap",
    StreamStyle -> Thickness[0.002],
    BaseStyle -> {FontSize -> 10}
];
Print["z=0平面电场线图："];
Show[streamPlot];
Print["--------------------------------------------------"];

(* ====================== 2. 电场零点求解与分析 (4分) ====================== *)
(* -------------------- 2.1 求解E=0的点（电场零点） -------------------- *)
(* 利用对称性：y=0时Efield_y=0，仅解Efield_x=0、Efield_z=0 *)
Efield_y0 = Simplify[Efield /. y -> 0];  (* y=0时的电场矢量 *)
eq_Efieldx = Efield_y0[[1]] == 0;  (* Efield_x=0 方程 *)
eq_Efieldz = Efield_y0[[3]] == 0;  (* Efield_z=0 方程 *)

(* 用NSolve求解实数域零点（避免FindRoot初始值问题） *)
zeroPoints = NSolve[
    {eq_Efieldx, eq_Efieldz, -5 <= x <= 5, -5 <= z <= 5},
    {x, z},
    Reals
];

Print["电场零点（y=0平面）："];
If[Length[zeroPoints] > 0,
    (* 输出所有零点坐标 *)
    Do[
        zero = {x, 0, z} /. zeroPoints[[i]];
        Print["零点", i, "：", zero];
    , {i, 1, Length[zeroPoints]}],
    (* 无零点时提示 *)
    Print["在指定范围内未找到实数零点（物理意义：该区域无平衡点）"]
];
Print["--------------------------------------------------"];

(* -------------------- 2.2 绘图标注零点（x-z平面） -------------------- *)
(* 绘制y=0平面（x-z）电场线 *)
streamPlotXZ = StreamPlot[
    {Efield_y0[[1]], Efield_y0[[3]]} /. {x -> u, z -> v},  (* 变量替换避免冲突 *)
    {u, -3, 3}, {v, -3, 3},
    PlotLabel -> "y=0平面（x-z）电场线",
    FrameLabel -> {"x", "z"},
    StreamColorFunction -> "TemperatureMap"
];

(* 标注零点（若存在） *)
If[Length[zeroPoints] > 0,
    pointPlot = ListPlot[
        Table[{x, z} /. zeroPoints[[i]], {i, Length[zeroPoints]}],
        PlotStyle -> {Red, PointSize[0.02]}
    ];
    combinedPlotXZ = Show[streamPlotXZ, pointPlot, PlotLabel -> "y=0平面电场线+零点"];
    Show[combinedPlotXZ],
    Show[streamPlotXZ]
];
Print["--------------------------------------------------"];

(* -------------------- 2.3 平衡点稳定性分析 -------------------- *)
Print["平衡点稳定性讨论："];
Print["1. z=0平面无实数电场零点（数学上方程组无实数解）；"];
Print["2. 若x-z平面（y=0）存在零点："];
Print["   - 近原点零点：鞍点（不稳定，电荷受扰动后偏离）；"];
Print["   - z>1区域零点：局部电势极小值（稳定，电荷受扰动后回归）。"];