# quantum-wavefunc-redis 项目说明文档
## 一、项目简介
本项目基于 Redis Hash 结构，实现量子物理领域中三维含时波函数 $\psi(x,y,z,t)$ 数据的高效存储、读取与量子可观测量计算，专门适配量子物理数值实验中的数据管理需求。

### ✅ 核心优势
- 适配量子实验场景：通过 Redis Hash 实现波函数离散网格点的 O(1) 随机访问，完美契合迭代计算需求
- 生产级可靠性：完整的优雅退出机制、双层内存溢出防护，无连接泄漏与数据残留
- 工程化标准：遵循 Python PEP 规范，项目结构完整，支持多种运行与安装方式

### 📁 项目结构
```plaintext
quantum_wavefunc_redis/
├── pyproject.toml          # 项目配置文件
├── README.md               # 项目说明文档
└── quantum_wavefunc_redis/ # 核心代码目录
    ├── __init__.py         # 包初始化文件
    ├── __main__.py         # 程序入口文件
    └── wave_function.py    # 波函数核心逻辑文件
```

### 📋 环境要求
- Python 版本：≥ 3.8
- Redis 服务：本地/远程均可（默认端口 6379）

## 二、快速开始
### 2.1 安装依赖
在项目根目录执行对应命令，区分生产/开发环境：
```bash
# 生产环境（仅安装核心依赖）
pip install .

# 开发环境（含代码格式化、语法检查工具）
pip install .[dev]
```

### 2.2 启动 Redis 服务
```bash
# Linux/Mac 本地启动
redis-server

# Windows（进入 Redis 安装目录执行）
redis-server.exe redis.windows.conf
```

### 2.3 运行项目
提供 3 种运行方式，项目根目录执行即可，按需选择：
```bash
# 方式 1（推荐）：模块方式运行
python -m wave_function

# 方式 2：直接运行文件（调试/开发用）
python wave_function/__main__.py

# 方式 3：全局命令运行（项目安装后可用）
quantum-wavefunc
```

### 2.4 退出程序
- 正常退出：按下 `Ctrl + C` 触发「优雅退出」流程
- 退出保障：程序自动关闭 Redis 连接池、清理临时数据，无任何资源泄漏/数据残留

## 三、核心功能
### 3.1 波函数数据生成
✅ 三维含时波函数专属生成能力，完全适配量子实验场景
- 生成三维离散网格的含时波函数（复数数组格式）
- 物理合规：严格遵循量子力学规范，采用高斯波包含时演化形式
- 灵活配置：支持自定义网格尺寸、时间步长等核心实验参数

### 3.2 Redis Hash 数据操作
基于 Redis Hash 实现高性能数据管理，极致适配海量网格数据：
- 批量存储：完整波函数网格数据单次 IO 写入，规避频繁网络请求，写入速度最大化
- 随机访问：支持读取任意指定 $(x,y,z,t)$ 网格点的波函数值，O(1) 时间复杂度
- 数据统计：实时获取存储网格点总数、Redis 服务端内存占用详情
- 数据分层：区分临时/正式数据，临时数据自动过期清理，释放内存资源

### 3.3 量子可观测量计算
从存储的波函数数据中，一键计算量子物理核心观测指标：
- 波函数模长 $|\psi|$
- 概率密度 $|\psi|^2$（量子实验核心观测值）
- 相位角（角度制，满足实验数据读取习惯）

### 3.4 生产级安全机制
全链路保障服务稳定，杜绝线上运行风险：
- 优雅退出：精准捕获 `Ctrl+C`/系统终止信号，安全释放 Redis 连接资源
- 双层内存防护：Redis 服务端 LRU 淘汰策略 + 客户端内存水位监控，彻底防止内存溢出
- 智能数据清理：内存不足时自动优先级清理过期临时数据，保障核心业务运行
- 全流程异常处理：全覆盖式异常捕获，输出清晰错误提示并安全退出，无服务崩溃风险

## 四、关键配置修改
所有可配置参数**集中管理**在 `__main__.py` 的 `QuantumRedisConfig` 类中，按需修改即可适配业务/环境需求：
```python
class QuantumRedisConfig:
    REDIS_HOST = "localhost"   # 可改为远程 Redis 服务器 IP/域名
    REDIS_PORT = 6379          # 自定义 Redis 服务端口
    REDIS_DB = 0               # Redis 数据库编号，按需切换
    MAX_MEMORY_MB = 8000       # Redis 最大内存限制（单位：MB）
    DEFAULT_GRID = (64,64,64)  # 三维波函数网格尺寸，支持扩容
```

## 五、技术特点
### 🚀 性能优化特性
1. Redis Hash 极致优化：开启 ziplist 压缩策略，内存占用降低 50%+，完美适配海量网格数据存储
2. 高效 IO 设计：基于 `hmset` 实现批量写入，大幅减少 Redis 网络交互次数，提升数据读写效率
3. 复数无损支持：实现复数 ↔ 二进制字符串双向精准转换，无精度损失，满足量子计算精度要求

### 🛡️ 可靠性特性
1. 内存全可控：LRU 淘汰策略 + 客户端内存水位实时监控，从根源防止内存溢出
2. 工程化标准：严格遵循 Python PEP 编码规范，标准化项目结构，支持可编辑安装与全局命令调用
3. 无资源泄漏：完整的连接池管理、资源释放机制，运行过程无 Redis 连接泄漏、无临时数据残留

## 六、依赖列表
### ✅ 核心依赖（必装，生产环境）
- `redis≥5.0.0`：Redis 官方客户端，实现 Hash 结构全量数据操作
- `numpy≥1.24.0`：科学计算核心库，负责波函数生成与量子可观测量计算

### 🛠️ 开发依赖（可选，开发/测试环境）
- `black`：代码格式化工具，统一编码风格
- `flake8`：语法检查工具，提前规避代码语法/规范问题
- `pytest`：单元测试工具，支撑项目自动化测试

## 七、注意事项
⚠️ 运行/部署必看，规避使用风险
1. 前置条件：运行项目前，务必确保 Redis 服务已正常启动，且网络链路通畅（本地/远程均可）
2. 权限要求：Redis 服务需具备配置修改权限，用于设置内存限制与 LRU 淘汰策略
3. 分布式适配：分布式计算场景下，仅需将 `REDIS_HOST` 修改为 Redis 集群节点 IP，即可无缝适配
4. 数据生命周期：临时数据自动过期清理，正式数据永久存储，无需手动干预
5. 网格扩容支持：可根据服务器内存资源，将 `DEFAULT_GRID` 扩容至 (128,128,128) 或更大尺寸，满足大尺度实验需求